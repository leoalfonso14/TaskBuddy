<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-0KCSZMXRL0"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-0KCSZMXRL0");
    </script>

    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Angkor&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Bitter:wght@900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="LoginStyles.css" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="favicon.io/favicon-16x16.png"
    />
    <title>Login Page</title>
  </head>

  <body class="LoginPage">
    <!-- Nav bar -->
    <div id="navlist">
      <img id="navimg" src="images/navbar.png" width="84" height="84" />
      <b><a id="mainTitle" href="index.html">TaskBuddy</a></b>
      <p id="noClickNav">Login</p>
      <a href="virtual.html">Virtual Pet</a>
      <a href="dashboard.html">Dashboard</a>
    </div>

    <div id="loginContent">
      <h1 class="BoxTitle">Login to your account</h1>
      <div class="BoxSubtitle">
        <p>Don't have an account? &nbsp</p>
        <p class="grow" id="createAcc" onclick="goToSignUp()">
          Create one here
        </p>
      </div>
      <div id="loginBox">
        <p id="email">Email address</p>
        <input type="text" id="emailBox" placeholder="" />
        <p id="password">Password</p>
        <div id="passDiv">
          <input type="password" id="passwordBox" placeholder="" />
          <span id="showPasswordIcon">
            <i class="bi bi-eye-slash" id="togglePassword"></i>
          </span>
        </div>
        <div>
          <p onclick="forgotPassword()" class="grow" id="forgotPasswordBtn">
            Forgot Password?
          </p>
        </div>

        <button id="signIn" class="grow" onclick="signIn()">Login</button>
        <!-- <button id="signUp" class="grow" onclick="signUp()">Sign Up</button> -->

        <!-- <div id="orContinueWith">Or continue with</div>
        <div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-google grow"
            viewBox="0 0 16 16"
            class="google"
            id="authorize_button"
            onclick="handleAuthClick()"
          >
            <path
              d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"
            />
          </svg>

          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-apple grow"
            viewBox="0 0 16 16"
            id="apple"
          >
            <path
              d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43Zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282Z"
            />
            <path
              d="M11.182.008C11.148-.03 9.923.023 8.857 1.18c-1.066 1.156-.902 2.482-.878 2.516.024.034 1.52.087 2.475-1.258.955-1.345.762-2.391.728-2.43Zm3.314 11.733c-.048-.096-2.325-1.234-2.113-3.422.212-2.189 1.675-2.789 1.698-2.854.023-.065-.597-.79-1.254-1.157a3.692 3.692 0 0 0-1.563-.434c-.108-.003-.483-.095-1.254.116-.508.139-1.653.589-1.968.607-.316.018-1.256-.522-2.267-.665-.647-.125-1.333.131-1.824.328-.49.196-1.422.754-2.074 2.237-.652 1.482-.311 3.83-.067 4.56.244.729.625 1.924 1.273 2.796.576.984 1.34 1.667 1.659 1.899.319.232 1.219.386 1.843.067.502-.308 1.408-.485 1.766-.472.357.013 1.061.154 1.782.539.571.197 1.111.115 1.652-.105.541-.221 1.324-1.059 2.238-2.758.347-.79.505-1.217.473-1.282Z"
            />
          </svg>
        </div> -->
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
      <!--  Content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Reset your TaskBuddy password</h2>
        <h4>
          Enter your email and click Reset to reset it. You will get an email
          with the request.
        </h4>
        <input type="text" id="emailReset" placeholder="email" />
        <button id="resetBtn" onclick="resetBtn('resetPassword')">Reset</button>
      </div>
    </div>

    <div class="footersection">
      <div class="socialMedia">
        <a class="footer-link grow" href="Team.html">Meet The Team</a>
        <a class="footer-link grow" href="">Instagram</a>
        <!-- Change the Youtube Link to the TaskBuddy youtube channel once created -->
        <a
          class="footer-link grow"
          href="https://www.youtube.com/@HunterPadilla-gb9qn/videos" target="_blank"
        >
          Youtube
        </p>
      </div>
      <a class="copyright">Â© 2023 TaskBuddy</a>
    </div>
  </body>

  <!--Scripts for firebase connections-->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  <script src="index.js"></script>

  <!--Google Auth Scripts-->
  <script type="text/javascript">
    /* exported gapiLoaded */
    /* exported gisLoaded */
    /* exported handleAuthClick */
    /* exported handleSignoutClick */

    // TODO(developer): Set to client ID and API key from the Developer Console
    const CLIENT_ID =
      "708512383332-dcv138klbh391jkmpihrgikq1dqg5d7k.apps.googleusercontent.com";
    const API_KEY = "AIzaSyCQvAEXJTf7oXADvFlf9PDrNTgbLHFE-Z4";

    // Discovery doc URL for APIs used by the quickstart
    const DISCOVERY_DOC =
      "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest";

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

    let tokenClient;
    let gapiInited = false;
    let gisInited = false;

    document.getElementById("authorize_button").style.visibility = "hidden";
    document.getElementById("signout_button").style.visibility = "hidden";

    /**
     * Callback after api.js is loaded.
     */
    function gapiLoaded() {
      gapi.load("client", initializeGapiClient);
    }

    /**
     * Callback after the API client is loaded. Loads the
     * discovery doc to initialize the API.
     */
    async function initializeGapiClient() {
      await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: [DISCOVERY_DOC],
      });
      gapiInited = true;
      maybeEnableButtons();
    }

    /**
     * Callback after Google Identity Services are loaded.
     */
    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: "", // defined later
      });
      gisInited = true;
      maybeEnableButtons();
    }

    /**
     * Enables user interaction after all libraries are loaded.
     */
    function maybeEnableButtons() {
      if (gapiInited && gisInited) {
        document.getElementById("authorize_button").style.visibility =
          "visible";
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick() {
      tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
          throw resp;
        }
        document.getElementById("signout_button").style.visibility = "visible";
        document.getElementById("authorize_button").innerText = "Refresh";
        await listUpcomingEvents();
      };

      if (gapi.client.getToken() === null) {
        // Prompt the user to select a Google Account and ask for consent to share their data
        // when establishing a new session.
        tokenClient.requestAccessToken({ prompt: "consent" });
      } else {
        // Skip display of account chooser and consent dialog for an existing session.
        tokenClient.requestAccessToken({ prompt: "" });
      }
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick() {
      const token = gapi.client.getToken();
      if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken("");
        document.getElementById("content").innerText = "";
        document.getElementById("authorize_button").innerText = "Authorize";
        document.getElementById("signout_button").style.visibility = "hidden";
      }
    }

    /**
     * Print the summary and start datetime/date of the next ten events in
     * the authorized user's calendar. If no events are found an
     * appropriate message is printed.
     */
    async function listUpcomingEvents() {
      let response;
      try {
        const request = {
          calendarId: "primary",
          timeMin: new Date().toISOString(),
          showDeleted: false,
          singleEvents: true,
          maxResults: 10,
          orderBy: "startTime",
        };
        response = await gapi.client.calendar.events.list(request);
      } catch (err) {
        document.getElementById("content").innerText = err.message;
        return;
      }

      const events = response.result.items;
      if (!events || events.length == 0) {
        document.getElementById("content").innerText = "No events found.";
        return;
      }
      // Flatten to string to display
      const output = events.reduce(
        (str, event) =>
          `${str}${event.summary} (${
            event.start.dateTime || event.start.date
          })\n`,
        "Events:\n"
      );
      document.getElementById("content").innerText = output;
    }
  </script>
  <script
    async
    defer
    src="https://apis.google.com/js/api.js"
    onload="gapiLoaded()"
  ></script>
  <script
    async
    defer
    src="https://accounts.google.com/gsi/client"
    onload="gisLoaded()"
  ></script>
</html>
